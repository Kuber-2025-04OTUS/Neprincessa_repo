# ДЗ № 7. 
## Описание основного задания 

- Создать манифест объекта CustomResourceDefinition со следующими параметрами:
    - Объект уровня namespace 
    - Api group - otus.homework 
    - Kind - MySQL 
    - Plural name - mysqls 
    - Версия - v1
- Объект должен иметь следующие обязательные атрибуты и правила их валидации (все поля строковые):
    - Image - определяет docker-образ для создания 
    - Database - имя базы данных 
    - Password - пароль от БД 
    - Storage_size - размер хранилища под базу 

- Создать манифест ServiceAccount, ClusterRole и ClusterRoleBinding, описывающий сервис аккаунт с полными правами на доступ к api серверу 
- Создать манифест deployment для оператора, указав созданный ранее ServiceAccount и образ roflmaoinmysoul/mysql-operator:1.0.0
- Создать манифест кастомного объекта kind: MySQL валидный для применения (см. атрибуты CRD созданного ранее)
- Применить все манифесты и убедиться, что CRD создался, оператор работает и при создании кастомного ресурса типа MySQL создаёт Deployment с указанным образом mysql, service для него, PV или PVC. При удалении объекта типа MySQL удаляются все созданные для него ресурсы


## Описание основного задания c *

- Изменить манифест ClusterRole, описав в нём минимальный набор прав доступа необходимые для нашего CRD и убедиться, что функциональность не пострадала 
- Управление сами ресурсом CRD 
- Создание и удаление типа Service, PV, PVC

## Описание основного задания c **

- Создать свой оператор, который будет реализовывать следующий функционал
- При создании в кластере объектов с типом MySQL (mysqls.otus.homework/v1) будет создаваться deployment с заданным образом mysql, сервис типа ClusterIP, PV, PVC заданного размера
- При удалении объекта с типом MySQL будет удалять ранее созданные ресурсы

# Запуск

create resources:

```
kubectl apply -f sa.yaml -f clusterrole.yaml -f crb.yaml -f crd.yaml 
kubectl apply -f deployment.yaml 
kubectl apply -f mysqlcrd.yaml
```

## Проверка работоспособности

- для оператора 

![alt text](image-1.png)

- для crd
![alt text](image-2.png)

## Удаление ресурсов

Видно, что были ресурсы, включая pv,pvc и при удалении mysql crd удаляется всё

![alt text](image-3.png)

## проверка валидности паттерна
если указать некорректное значение в размере, то выдаёт ошибку 

![alt text](image-4.png)
